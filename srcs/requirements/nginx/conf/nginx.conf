ssl_certificate         /etc/nginx/ssl/inception.crt;
ssl_certificate_key     /etc/nginx/ssl/inception.key;

# Server for unknown domains
# (The first server block is the fallback server)
server {
    listen 443 ssl;                                         # IPv4
    listen [::]:443 ssl;                                    # IPv6
    ssl_protocols           TLSv1.2 TLSv1.3;                # SSL protocols
    server_name _;                                          # Unknown domain
    location / {    
        return 444;
    }
}

server {
    listen                  443 ssl;
    listen                  [::]:443 ssl;
    ssl_protocols           TLSv1.2 TLSv1.3;
    server_name             TRANSCENDENCE;

    # frontend
    location / {
        root                /code/dist;
        try_files           $uri $uri/ /index.html;
    }

    # reverse proxy for adminer
    location /adminer {
        proxy_pass          http://adminer:8080;
        proxy_set_header    Host $host;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
    }

    # reverse proxy for backend
    location /endpoint/ {
        proxy_pass          http://backend:8000;
        proxy_set_header    Host $host;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto $scheme;
    }
}
